<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¢Œì„ ì„ íƒ</title>
<style>
body {
	margin: 0;
	font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR",
		sans-serif;
	background: #111;
	color: #eee
}

.wrap {
	max-width: 960px;
	margin: 24px auto;
	padding: 0 16px
}

h1 {
	font-size: 22px;
	margin: 16px 0 12px;
	text-align: center
}

.person-selector {
	text-align: center;
	margin: 20px 0
}

.person-selector select {
	padding: 8px 16px;
	border: 1px solid #555;
	border-radius: 6px;
	background: #2a2a2a;
	color: #ddd;
	font-size: 16px;
	cursor: pointer
}

.screen {
	background: linear-gradient(135deg, #444, #333);
	color: #fff;
	text-align: center;
	padding: 12px;
	border-radius: 8px;
	margin: 20px auto;
	font-weight: bold;
	box-shadow: 0 2px 10px rgba(0, 0, 0, .3)
}

.theater {
	background: #1a1a1a;
	border-radius: 12px;
	padding: 20px;
	margin: 20px 0
}

.seating-grid {
	display: grid;
	grid-template-columns: 50px repeat(2, 40px) 20px repeat(6, 40px) 20px
		repeat(2, 40px);
	gap: 8px;
	justify-content: center;
	align-items: center
}

.row-header, .col-header {
	color: #aaa;
	text-align: center;
	font-size: 14px
}

.seat-container {
	position: relative
}

.seat-checkbox {
	position: absolute;
	opacity: 0;
	width: 0;
	height: 0
}

.seat {
	display: block;
	width: 36px;
	height: 36px;
	line-height: 34px;
	text-align: center;
	border: 1px solid #444;
	border-radius: 6px;
	background: #2a2a2a;
	cursor: pointer;
	user-select: none;
	transition: all .2s ease;
	font-size: 12px;
	color: #ccc
}

.seat:hover {
	background: #3a3a3a;
	border-color: #666
}

.seat-checkbox:checked+.seat {
	background: #ff3d7b;
	border-color: #ff3d7b;
	color: #fff;
	box-shadow: 0 0 10px rgba(255, 61, 123, .3)
}

.selected-info {
	text-align: center;
	margin: 20px 0;
	padding: 15px;
	background: #222;
	border-radius: 8px;
	border-left: 4px solid #ff3d7b
}

.selected-seats {
	margin-top: 10px;
	color: #ff3d7b;
	font-weight: bold
}

.actions {
	text-align: center;
	margin-top: 30px
}

.btn {
	padding: 12px 24px;
	border: 0;
	border-radius: 8px;
	cursor: pointer;
	font-size: 14px;
	font-weight: 500;
	margin: 0 8px;
	transition: all .2s ease
}

.btn.primary {
	background: #ff3d7b;
	color: #fff
}

.btn.primary:disabled {
	background: #666;
	cursor: not-allowed
}

.btn.secondary {
	background: #333;
	color: #ddd;
	border: 1px solid #555
}

.warning {
	color: #ff6b6b;
	font-size: 14px;
	margin-top: 10px
}
/* ì˜ˆë§¤ ì™„ë£Œ ëª¨ë‹¬ */
.modal {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, .8);
	z-index: 1000
}

.modal-content {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	background: #1a1a1a;
	border-radius: 12px;
	padding: 30px;
	max-width: 400px;
	width: 90%;
	text-align: center;
	border: 1px solid #333
}

.modal-content h2 {
	color: #ff3d7b;
	margin-bottom: 20px;
	font-size: 24px
}

.booking-info {
	background: #222;
	padding: 20px;
	border-radius: 8px;
	margin: 20px 0;
	text-align: left
}

.booking-info div {
	margin: 8px 0;
	display: flex;
	justify-content: space-between
}

.booking-info .label {
	color: #aaa
}

.booking-info .value {
	color: #fff;
	font-weight: bold
}

.booking-number {
	background: #ff3d7b;
	color: #fff;
	padding: 10px;
	border-radius: 6px;
	font-weight: bold;
	font-size: 18px;
	margin: 15px 0
}
</style>
</head>
<body>
	<%@ include file="header.jsp"%>

	<div class="wrap">
		<h1>ì¢Œì„ ì„ íƒ</h1>

		<div class="person-selector">
			<label>ì¸ì› ìˆ˜: </label> <select id="personCount">
				<option value="1">1ëª…</option>
				<option value="2">2ëª…</option>
				<option value="3">3ëª…</option>
				<option value="4">4ëª…</option>
				<option value="5">5ëª…</option>
				<option value="6">6ëª…</option>
			</select>
		</div>

		<div class="screen">SCREEN</div>

		<div class="theater">
			<div class="seating-grid" id="grid"></div>

			<div class="selected-info" id="selectedInfo" style="display: none;">
				<div>
					ì„ íƒëœ ì¢Œì„ (<span id="selectedCount">0</span>/<span id="maxCount">1</span>)
				</div>
				<div class="selected-seats" id="selectedSeats"></div>
				<div class="warning" id="warning" style="display: none;"></div>
			</div>

			<div class="actions">
				<button type="button" class="btn primary" id="confirmBtn" disabled
					onclick="completeBooking()">ì¢Œì„ ì„ íƒ ì™„ë£Œ</button>
				<button type="button" class="btn secondary" onclick="history.back()">ë’¤ë¡œê°€ê¸°</button>
			</div>
		</div>
	</div>

	<!-- ì˜ˆë§¤ ì™„ë£Œ ëª¨ë‹¬ -->
	<div class="modal" id="bookingModal">
		<div class="modal-content">
			<h2>ğŸ¬ ì˜ˆë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
			<div class="booking-info">
				<div>
					<span class="label">ì˜í™”:</span><span class="value">ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„</span>
				</div>
				<div>
					<span class="label">ê·¹ì¥:</span><span class="value">ì„œìš¸ë„ì‹¬ì˜í™”ê´€</span>
				</div>
				<div>
					<span class="label">ìƒì˜ì¼ì‹œ:</span><span class="value">2025ë…„ 8ì›”
						20ì¼ 13:30</span>
				</div>
				<div>
					<span class="label">ì¢Œì„:</span><span class="value" id="modalSeats"></span>
				</div>
				<div>
					<span class="label">ì¸ì›:</span><span class="value" id="modalPersons"></span>
				</div>
				<div>
					<span class="label">ì´ ê¸ˆì•¡:</span><span class="value" id="modalPrice"></span>
				</div>
			</div>
			<div class="booking-number">
				ì˜ˆë§¤ë²ˆí˜¸: <span id="bookingNumber"></span>
			</div>
			<div class="actions">
				<button type="button" class="btn primary" onclick="goHome()">í™ˆìœ¼ë¡œ</button>
				<button type="button" class="btn secondary" onclick="closeModal()">ë’¤ë¡œê°€ê¸°</button>
			</div>
		</div>
	</div>

	<script>
//ì„¤ì •
const ROWS = ["A","B","C","D"];
const COLS = [1,2, "gap", 3,4,5,6,7,8, "gap", 9,10]; // ë³µë„ ìœ ì§€
const PRICE = 14000; // ê¸ˆì•¡

// ====== ìƒíƒœ ======
let maxSeats = 1;
let selectedSeats = [];

//ì¢Œì„ ê·¸ë¦¬ë“œ ë™ì  ìƒì„± (C3, C5, C10 í¬í•¨ ì „ë¶€ ì„ íƒ ê°€ëŠ¥)
(function buildGrid(){
  const grid = document.getElementById('grid');

  // ì—´ í—¤ë” ë¼ì¸
  grid.appendChild(document.createElement('div')); // ì™¼ìª½ ë¹ˆì¹¸
  for (const c of COLS){
    const el = document.createElement('div');
    if (c === "gap") el.textContent = "";
    else { el.className = "col-header"; el.textContent = c; }
    grid.appendChild(el);
  }

  // ê° í–‰
  for (const r of ROWS){
    // í–‰ ë¨¸ë¦¬ê¸€
    const rowHead = document.createElement('div');
    rowHead.className = "row-header";
    rowHead.textContent = r;
    grid.appendChild(rowHead);

    // ì¢Œì„ë“¤
    for (const c of COLS){
      const cell = document.createElement('div');
      if (c === "gap"){
        grid.appendChild(cell); // ë¹ˆì¹¸(ë³µë„)
        continue;
      }
      cell.className = "seat-container";

      const id = r + c;
      const input = document.createElement('input');
      input.type = "checkbox";
      input.className = "seat-checkbox";
      input.id = id;
      input.value = id;

      const label = document.createElement('label');
      label.className = "seat";
      label.setAttribute('for', id);
      label.textContent = id;

      cell.appendChild(input);
      cell.appendChild(label);
      grid.appendChild(cell);
    }
  }
})();

// ì¸ì› ì„ íƒ
document.getElementById('personCount').addEventListener('change', function(){
  maxSeats = parseInt(this.value, 10);
  document.getElementById('maxCount').textContent = maxSeats;
  if (selectedSeats.length > maxSeats){
    document.querySelectorAll('.seat-checkbox').forEach(cb => cb.checked = false);
    selectedSeats = [];
  }
  updateDisplay();
});

// ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ì¢Œì„ ì„ íƒ ê´€ë¦¬
document.getElementById('grid').addEventListener('change', function(e){
  if (!e.target.classList.contains('seat-checkbox')) return;
  const seatValue = e.target.value;
  if (e.target.checked){
    if (selectedSeats.length >= maxSeats){
      e.target.checked = false;
      showWarning(`ìµœëŒ€ ${maxSeats}ëª…ê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
      return;
    }
    selectedSeats.push(seatValue);
  } else {
    selectedSeats = selectedSeats.filter(s => s !== seatValue);
  }
  updateDisplay();
});

// ì˜ˆë§¤ ì™„ë£Œ ì²˜ë¦¬
function completeBooking(){
  if (selectedSeats.length !== maxSeats){
    showWarning(`ì •í™•íˆ ${maxSeats}ëª…ì˜ ì¢Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`);
    return;
  }
  document.getElementById('modalSeats').textContent = selectedSeats.join(', ');
  document.getElementById('modalPersons').textContent = maxSeats + 'ëª…';
  document.getElementById('modalPrice').textContent = (maxSeats * PRICE).toLocaleString() + 'ì›';
  document.getElementById('bookingNumber').textContent = genBookingNumber('LX', 8); // â† ê¸¸ì´ ë°”ê¾¸ë ¤ë©´ ë‘ë²ˆì§¸ ì¸ì ë³€ê²½
  document.getElementById('bookingModal').style.display = 'block';

  // ì˜ˆë§¤ ì™„ë£Œ í›„ ì¢Œì„ ê³ ì •(ì„ íƒ ë¶ˆê°€)
  document.querySelectorAll('.seat-checkbox').forEach(cb=>{
    if (selectedSeats.includes(cb.value)) {
      cb.disabled = true;
      cb.parentElement.querySelector('.seat').style.opacity = 0.85;
    } else {
      cb.checked = false;
      cb.disabled = true; // ì „ì²´ ì ê¸ˆ(í•„ìš” ì—†ìœ¼ë©´ ì´ ì¤„ ì œê±°)
    }
  });
}

// LX + ìˆ«ìë§Œ ëœë¤ Nìë¦¬
function genBookingNumber(prefix='LX', digits=8){
  let s = '';
  for (let i=0;i<digits;i++){
    s += Math.floor(Math.random()*10); // 0~9
  }
  return prefix + s;
}

function goHome(){ window.location.href = 'home.do'; }
document.getElementById('bookingModal').addEventListener('click', e => { if (e.target === e.currentTarget) goHome(); });

function goHome(){ 
	  window.location.href = 'home.do'; 
	}

	// === ì—¬ê¸°ë¶€í„° ì¶”ê°€ ===
	function closeModal() {
	  document.getElementById('bookingModal').style.display = 'none';
	}

	// ë°±ë“œë¡­ í´ë¦­ ì‹œ ëª¨ë‹¬ë§Œ ë‹«ê¸°
	document.getElementById('bookingModal').addEventListener('click', function(e) {
	  if (e.target === this) closeModal();
	});

	// ëª¨ë‹¬ ë‚´ë¶€ í´ë¦­ì€ ë²„ë¸”ë§ ë°©ì§€ (ì„ íƒ)
	document.querySelector('#bookingModal .modal-content')
	  .addEventListener('click', (e) => e.stopPropagation());
	
</script>
</body>
</html>